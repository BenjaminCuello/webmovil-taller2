# API de Países - Express.js

Esta API proporciona datos de países y está construida con Express.js y PostgreSQL. Los datos provienen de `database.sql` / `countries-seed.json` y **no** llama a RestCountries en tiempo de ejecución.

## Ejecución con Docker Compose

El servicio `express` y la base de datos `postgres-db` están definidos en `docker-compose.yml` en la raíz.

1. Desde la raíz del repositorio:

   docker compose up --build

2. La API quedará disponible en `http://localhost:4000`.
   Por defecto escucha en el puerto `4000`, pero se puede sobreescribir con la variable de entorno `PORT`.

La base de datos se inicializa automáticamente con `backend/express/database.sql` y, al arrancar `server.js`, se comprueba que existan al menos 30 países; si no, se vuelven a insertar desde `countries-seed.json`.

---

## Endpoints

### `GET /countries`

Devuelve una lista de todos los países almacenados.

**Respuesta de ejemplo:**

```json
[
  {
    "name": { "common": "Argentina", "official": "Argentine Republic" },
    "flags": {
      "png": "https://flagcdn.com/w320/ar.png",
      "svg": "https://flagcdn.com/ar.svg"
    },
    "region": "Americas",
    "capital": ["Buenos Aires"],
    "population": 45376763,
    "cca2": "AR"
  }
]
```

### `GET /countries/search?name=<nombre>`

Busca países cuyo `name.common` contenga el texto proporcionado (búsqueda case-insensitive).

**Ejemplo:** `http://localhost:4000/countries/search?name=chile`

**Respuesta de ejemplo:**

````json
[
  {
    "name": { "common": "Chile", "official": "Republic of Chile" },
    "flags": {
      "png": "https://flagcdn.com/w320/cl.png",
      # API de Países (Express + PostgreSQL)

      ## 1) Nombre y propósito
      Entrega un catálogo de países para el frontend del Taller 2. Replica lo mínimo de RestCountries usado en el Taller 1 (nombre común/oficial, banderas, región, capital, población, `cca2`). No consume servicios externos en tiempo de ejecución.

      ## 2) Tecnología
      - Express.js (Node.js)
      - PostgreSQL
      - Docker Compose (para desarrollo/ejecución rápida)

      ## 3) Cómo ejecutarla

      ### Opción A — Docker Compose (recomendada)
      Desde la raíz del repositorio:
      ```bash
      docker compose up --build
      ```
      Servicio disponible en `http://localhost:4000` (variable `PORT` opcional).

      ### Opción B — Local (sin Docker)
      1) Crear BD y cargar schema/datos:
      ```bash
      createdb countries_db
      psql -d countries_db -f backend/express/database.sql
      ```
      2) Variables de entorno pg compatibles con `db.js` (ejemplo):
      ```bash
      set PGUSER=postgres
      set PGHOST=localhost
      set PGDATABASE=countries_db
      set PGPASSWORD=postgres
      set PGPORT=5432
      ```
      3) Instalar y levantar:
      ```bash
      cd backend/express
      npm install
      node server.js
      ```
      Disponible en `http://localhost:4000`.

      ## 4) Endpoints
      - `GET /countries` → lista completa de países
      - `GET /countries/search?name=<texto>` → búsqueda por nombre (case-insensitive)

      ## 5) Ejemplos de respuesta
      `GET /countries` (fragmento):
      ```json
      [
        {
          "name": { "common": "Argentina", "official": "Argentine Republic" },
          "flags": { "png": "https://flagcdn.com/w320/ar.png", "svg": "https://flagcdn.com/ar.svg" },
          "region": "Americas",
          "capital": ["Buenos Aires"],
          "population": 45376763,
          "cca2": "AR"
        }
      ]
      ```

      `GET /countries/search?name=chile`:
      ```json
      [
        {
          "name": { "common": "Chile", "official": "Republic of Chile" },
          "flags": { "png": "https://flagcdn.com/w320/cl.png", "svg": "https://flagcdn.com/cl.svg" },
          "region": "Americas",
          "capital": ["Santiago"],
          "population": 19116201,
          "cca2": "CL"
        }
      ]
      ```

      ## 6) Notas sobre la base de datos
      - Origen de datos: `backend/express/database.sql` (crea tabla `countries` y carga 30+ países) y `countries-seed.json`.
      - Inicialización: al iniciar `server.js` se verifica el conteo; si hay menos de 30 registros, se reinyectan desde `countries-seed.json`.
      - Campos persistidos: `common_name`, `official_name`, `cca2`, `region`, `capital`, `population`, `flag_png`, `flag_svg`.

````
