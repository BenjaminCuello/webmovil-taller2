Frontend - InfoMóvil Taller 2
=============================

Este directorio contiene la aplicación web móvil (HTML + Tailwind + JS puro) que se empaquetará con Apache Cordova.

Requisitos
----------
- Node.js >= 16 (para ejecutar el script `sync-www.js`).
- Cordova CLI instalado globalmente (`npm install -g cordova`) cuando vayas a generar el APK.

Estructura
----------

```
frontend/
├── Dockerfile          # Nginx que sirve /www
└── www/
    ├── index.html      # Landing + vistas de detalle
    ├── styles.css      # Estilos base adicionales a Tailwind
    ├── js/             # Lógica separada por dominio
    │   ├── config.js   # MODE + URLs (public/local/mock)
    │   ├── api.js      # Fetch a APIs (públicas, locales o mocks)
    │   ├── *.js        # Módulos de Pokémon, Países, Clima, Feriados
    └── mock/           # Datos locales para MODE='mock'
```

Modos de ejecución
------------------

- `public` (default): usa las APIs públicas del Taller 1.
- `local`: usa los backends propios (Nest/Express/FastAPI). Ajusta las URL en `js/config.js`.
- `mock`: usa los JSON de `frontend/www/mock/` (sin depender de Internet ni backend).

Cambiar modo:

1. Desde el encabezado de la app usando el selector de modo (se persiste en `localStorage`).
2. Editar `frontend/www/js/config.js` y setear `var MODE = 'mock'` o `var MODE = 'local'`.
3. Para pruebas puntuales se puede usar query param, ej: `http://localhost:8080/?mode=mock`.

Servir el frontend
------------------

### Docker Compose (recomendado)

```bash
# Desde la raíz del repositorio
docker-compose up --build frontend --no-deps
# Frontend disponible en http://localhost:8080
```

### Nginx standalone

```bash
docker build -t infomovil-frontend -f frontend/Dockerfile frontend
docker run --rm -p 8080:80 infomovil-frontend
```

### Servidor estático simple (sin Docker)

```bash
cd frontend/www
npx serve .
# o cualquier servidor estático: python -m http.server, etc.
```

### Script para sincronizar con Cordova

Puedes usar `scripts/sync-www.js` para copiar el `frontend/www/` directamente a la carpeta `www/` de tu proyecto Cordova:

```bash
node scripts/sync-www.js --target ../infomovil-app/www
```

Opciones adicionales:
- `--keep`: no limpia la carpeta destino antes de copiar (por defecto se elimina el contenido previo).

Empaquetado Cordova (APK)
-------------------------

1. `cordova create infomovil-app com.infomovil.app InfoMovil`
2. `cd infomovil-app`
3. `cordova plugin add cordova-plugin-whitelist`
4. `cordova platform add android`
5. Copiar el contenido de `frontend/www/` sobre `infomovil-app/www/`
   - En Linux/macOS: `rsync -av --delete ../webmovil-taller2/frontend/www/ www/`
   - En Windows: copiar/pegar manualmente o usar `robocopy`
6. Copiar `www/js/config.sample.js` como `www/js/config.js` (o actualizar el existente)
7. Ajustar `MODE` según el entorno (mock/local) dentro de `www/js/config.js`
8. `cordova build android`

El APK debug queda en `platforms/android/app/build/outputs/apk/debug/`.

Checklist antes de empaquetar
-----------------------------

- Verifica el modo en el selector del header (`mock` para demos sin backend, `local` para entornos integrados).
- Copia `www/js/config.sample.js` como `config.js` para comenzar con valores limpios (o actualiza el existente).
- Ajusta las URLs en `www/js/config.js` a los hosts reales (`10.0.2.2`, IP LAN o dominios desplegados).
- Copia la carpeta `www/mock/` si necesitas datos locales dentro del APK final.
- Ejecuta la app en emulador/dispositivo y confirma que los servicios responden (revisión rápida de cada vista).
- Revisa permisos en `config.xml` (`<allow-navigation>` / `<access>`) para las URLs finales.

Integración con backends
------------------------

- NestJS debe exponer `/pokemon` (lista + detalle) y habilitar CORS (`GET` desde `http://localhost:8080`).
- Express debe exponer `/countries` y `/countries/search` con los campos consumidos por el frontend.
- FastAPI debe exponer `/weather?city=` y `/holidays/{country}/{year}` retornando el mismo payload que los mocks.
- Si desplegarás en dispositivos reales, considera usar HTTPS o un túnel (ngrok, localtunnel) para evitar bloqueos.
- Documenta en `README.md` cualquier credencial necesaria o variable de entorno para los backends.

Notas útiles
------------

- En emulador Android recuerda reemplazar `localhost` por `10.0.2.2` en `config.js`.
- Para producción conviene mover Tailwind a un build local o CDN con integrity.
- Los mocks sirven de referencia para que el backend replique el mismo contrato.
- Cualquier cambio en `frontend/www/` debe sincronizarse con el proyecto Cordova antes de compilar.
